--[[
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         ROBLOX MAP ANALYZER - ADVANCED VERSION
         Compatible: Delta Android
         Version: 3.0 - ULTRA UPGRADED
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    NEW FEATURES:
    ‚úì Simplified GUI (Based on analyzer.lua)
    ‚úì Execute button on input values
    ‚úì Deep scan ALL assets recursively
    ‚úì Complete effect descriptions
    ‚úì Performance optimized (no lag)
    ‚úì HTTP Request tracking for vulnerabilities
]]

-- ==================== SERVICES ====================
local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- ==================== ANALYZER MODULE ====================
local MapAnalyzer = {}
MapAnalyzer.Results = {Low = {}, Medium = {}, High = {}, HTTP = {}, TotalVulnerabilities = 0}

local Config = {
    ScanRadius = 500,
    MinExploitableHeight = 10,
    MaxScanTime = 30,
    IgnoreNames = {"Baseplate", "Base", "Ground"},
    BatchSize = 50, -- Process in batches to prevent lag
    YieldInterval = 100 -- Yield every N objects
}

-- HTTP Request Tracker
local HTTPTracker = {
    Requests = {},
    VulnerableEndpoints = {}
}

-- Track HTTP requests
local originalHttpGet = HttpService.GetAsync
local originalHttpPost = HttpService.PostAsync

-- Hook HTTP requests (if possible)
pcall(function()
    -- Try to hook HttpService methods
    local mt = getrawmetatable(HttpService)
    if mt then
        local oldIndex = mt.__index
        mt.__index = function(self, key)
            if key == "GetAsync" then
                return function(url, ...)
                    table.insert(HTTPTracker.Requests, {
                        Type = "GET",
                        URL = url,
                        Time = tick(),
                        Vulnerable = HTTPTracker:CheckVulnerability(url)
                    })
                    return oldIndex(self, key)(url, ...)
                end
            elseif key == "PostAsync" then
                return function(url, data, ...)
                    table.insert(HTTPTracker.Requests, {
                        Type = "POST",
                        URL = url,
                        Data = data,
                        Time = tick(),
                        Vulnerable = HTTPTracker:CheckVulnerability(url)
                    })
                    return oldIndex(self, key)(url, data, ...)
                end
            end
            return oldIndex(self, key)
        end
    end
end)

function HTTPTracker:CheckVulnerability(url)
    local urlLower = string.lower(url)
    local vulnerablePatterns = {
        "http://", -- Insecure HTTP
        "localhost", -- Local endpoints
        "127.0.0.1", -- Localhost IP
        "192.168", -- Local network
        "10.0", -- Private network
        "api/", -- API endpoints
        "admin", -- Admin endpoints
        "config", -- Config files
        ".json", -- JSON files
        ".xml", -- XML files
        "token", -- Token endpoints
        "auth", -- Auth endpoints
        "login", -- Login endpoints
        "password", -- Password endpoints
        "user", -- User data
        "data", -- Data endpoints
    }
    
    for _, pattern in ipairs(vulnerablePatterns) do
        if urlLower:match(pattern) then
            return true
        end
    end
    return false
end

-- UTILITY: Remove Duplicates
local function removeDuplicates(issues)
    local seen = {}
    local unique = {}

    for _, issue in pairs(issues) do
        local key = issue.Type .. "_" .. tostring(issue.Path)
        if not seen[key] then
            seen[key] = true
            table.insert(unique, issue)
        end
    end

    return unique
end

-- UTILITY: Get Effect Description
local function getEffectDescription(vulnType, obj)
    local effects = {
        ["Unanchored Part"] = "‚ö†Ô∏è EFEK: Part bisa dipindahkan/didorong, bisa menyebabkan exploit noclip atau bypass barrier",
        ["No Collision"] = "‚ö†Ô∏è EFEK: Part bisa ditembus, player bisa walk through barrier",
        ["Transparent"] = "‚ö†Ô∏è EFEK: Barrier transparan, bisa di-exploit untuk melihat area terlarang",
        ["Out of Bounds"] = "‚ö†Ô∏è EFEK: Part di luar batas map, bisa digunakan untuk teleport exploit",
        ["Climbable"] = "‚ö†Ô∏è EFEK: TrussPart bisa dipanjat, bisa bypass barrier tinggi",
        ["Spawn Exploit"] = "‚ö†Ô∏è EFEK: Spawn di ketinggian, bisa digunakan untuk teleport exploit",
        ["Hidden Click"] = "‚ö†Ô∏è EFEK: ClickDetector tersembunyi, bisa di-trigger tanpa terlihat",
        ["Proximity"] = "‚ö†Ô∏è EFEK: ProximityPrompt bisa di-trigger dari jarak jauh dengan exploit",
        ["Free Tool"] = "‚ö†Ô∏è EFEK: Tool bisa diambil gratis, bisa digunakan untuk exploit",
        ["Remote"] = "‚ö†Ô∏è EFEK: RemoteEvent/Function bisa di-fire dari client, bisa menyebabkan RCE atau data manipulation",
        ["HTTP Request"] = "‚ö†Ô∏è EFEK: HTTP request ke endpoint yang vulnerable, bisa menyebabkan data leak atau injection"
    }
    
    return effects[vulnType] or "‚ö†Ô∏è EFEK: Potensi exploit atau vulnerability"
end

-- DEEP SCAN: Get ALL descendants recursively
local function deepScanContainer(container, callback, processed)
    processed = processed or {}
    local count = 0
    
    local function scanRecursive(obj)
        if processed[obj] then return end
        processed[obj] = true
        count = count + 1
        
        -- Process current object
        callback(obj)
        
        -- Process all children recursively
        for _, child in pairs(obj:GetChildren()) do
            scanRecursive(child)
        end
        
        -- Yield periodically to prevent lag
        if count % Config.YieldInterval == 0 then
            wait()
        end
    end
    
    -- Start from container
    scanRecursive(container)
    
    return count
end

-- LOW SEVERITY SCAN (DEEP)
function MapAnalyzer:ScanLowVulnerabilities()
    local lowIssues = {}
    local processed = {}
    local count = 0
    
    -- Scan workspace deeply
    deepScanContainer(workspace, function(obj)
        count = count + 1
        
        if obj:IsA("BasePart") then
            if not obj.Anchored then
                local ignore = false
                for _, name in pairs(Config.IgnoreNames) do
                    if string.find(obj.Name:lower(), name:lower()) then
                        ignore = true
                        break
                    end
                end
                if not ignore then
                    table.insert(lowIssues, {
                        Type = "Unanchored Part",
                        Object = obj,
                        Position = obj.Position,
                        Description = "Part tidak di-anchor",
                        Effect = getEffectDescription("Unanchored Part", obj),
                        Path = obj:GetFullName(),
                        EditableProps = {
                            {Name = "Anchored", Value = obj.Anchored, Type = "boolean"},
                            {Name = "Transparency", Value = obj.Transparency, Type = "number"},
                            {Name = "CanCollide", Value = obj.CanCollide, Type = "boolean"}
                        }
                    })
                end
            end
            if not obj.CanCollide then
                table.insert(lowIssues, {
                    Type = "No Collision",
                    Object = obj,
                    Position = obj.Position,
                    Description = "Bisa ditembus",
                    Effect = getEffectDescription("No Collision", obj),
                    Path = obj:GetFullName(),
                    EditableProps = {
                        {Name = "CanCollide", Value = obj.CanCollide, Type = "boolean"},
                        {Name = "Transparency", Value = obj.Transparency, Type = "number"}
                    }
                })
            end
            if obj.Transparency >= 0.8 then
                table.insert(lowIssues, {
                    Type = "Transparent",
                    Object = obj,
                    Position = obj.Position,
                    Description = "Barrier transparan",
                    Effect = getEffectDescription("Transparent", obj),
                    Path = obj:GetFullName(),
                    EditableProps = {
                        {Name = "Transparency", Value = obj.Transparency, Type = "number"},
                        {Name = "CanCollide", Value = obj.CanCollide, Type = "boolean"}
                    }
                })
            end
        end
    end, processed)
    
    print("[SCAN] Low vulnerabilities: " .. #lowIssues .. " (scanned " .. count .. " objects)")
    return removeDuplicates(lowIssues)
end

-- MEDIUM SEVERITY SCAN (DEEP)
function MapAnalyzer:ScanMediumVulnerabilities()
    local mediumIssues = {}
    local processed = {}
    local count = 0
    
    -- Scan all services deeply
    local containers = {workspace, ReplicatedStorage, game:GetService("ServerStorage"), game:GetService("StarterGui")}
    
    for _, container in pairs(containers) do
        deepScanContainer(container, function(obj)
            count = count + 1
            
            if obj:IsA("BasePart") then
                if obj.Position.Y < -100 or obj.Position.Y > 1000 then
                    table.insert(mediumIssues, {
                        Type = "Out of Bounds",
                        Object = obj,
                        Position = obj.Position,
                        Description = "Y: " .. math.floor(obj.Position.Y),
                        Effect = getEffectDescription("Out of Bounds", obj),
                        Path = obj:GetFullName(),
                        EditableProps = {
                            {Name = "Position", Value = obj.Position, Type = "vector3"},
                            {Name = "Anchored", Value = obj.Anchored, Type = "boolean"}
                        }
                    })
                end
            end
            if obj:IsA("TrussPart") then
                table.insert(mediumIssues, {
                    Type = "Climbable",
                    Object = obj,
                    Position = obj.Position,
                    Description = "Bisa dipanjat",
                    Effect = getEffectDescription("Climbable", obj),
                    Path = obj:GetFullName(),
                    EditableProps = {
                        {Name = "CanCollide", Value = obj.CanCollide, Type = "boolean"},
                        {Name = "Transparency", Value = obj.Transparency, Type = "number"}
                    }
                })
            end
            if obj:IsA("SpawnLocation") then
                if obj.Position.Y > Config.MinExploitableHeight then
                    table.insert(mediumIssues, {
                        Type = "Spawn Exploit",
                        Object = obj,
                        Position = obj.Position,
                        Description = "Spawn tinggi",
                        Effect = getEffectDescription("Spawn Exploit", obj),
                        Path = obj:GetFullName(),
                        EditableProps = {
                            {Name = "Position", Value = obj.Position, Type = "vector3"},
                            {Name = "Enabled", Value = obj.Enabled, Type = "boolean"},
                            {Name = "Duration", Value = obj.Duration, Type = "number"}
                        }
                    })
                end
            end
        end, processed)
    end
    
    print("[SCAN] Medium vulnerabilities: " .. #mediumIssues .. " (scanned " .. count .. " objects)")
    return removeDuplicates(mediumIssues)
end

-- HIGH SEVERITY SCAN (DEEP) + HTTP TRACKING
function MapAnalyzer:ScanHighVulnerabilities()
    local highIssues = {}
    local processed = {}
    local count = 0
    
    -- Scan ALL services deeply
    local containers = {
        workspace, 
        ReplicatedStorage, 
        game:GetService("ServerStorage"),
        game:GetService("StarterGui"),
        game:GetService("StarterPack"),
        game:GetService("StarterPlayer"),
        playerGui,
        player
    }
    
    for _, container in pairs(containers) do
        pcall(function()
            deepScanContainer(container, function(obj)
                count = count + 1
                
                if obj:IsA("ClickDetector") then
                    local parent = obj.Parent
                    if parent and parent:IsA("BasePart") and parent.Transparency >= 0.5 then
                        table.insert(highIssues, {
                            Type = "Hidden Click",
                            Object = parent,
                            Position = parent.Position,
                            Description = "ClickDetector tersembunyi",
                            Effect = getEffectDescription("Hidden Click", obj),
                            Path = parent:GetFullName(),
                            EditableProps = {
                                {Name = "MaxActivationDistance", Value = obj.MaxActivationDistance, Type = "number"},
                                {Name = "Transparency", Value = parent.Transparency, Type = "number"}
                            }
                        })
                    end
                end
                if obj:IsA("ProximityPrompt") then
                    local parent = obj.Parent
                    table.insert(highIssues, {
                        Type = "Proximity",
                        Object = parent,
                        Position = parent:IsA("BasePart") and parent.Position or Vector3.new(0,0,0),
                        Description = "Bisa diexploit",
                        Effect = getEffectDescription("Proximity", obj),
                        Path = obj:GetFullName(),
                        EditableProps = {
                            {Name = "MaxActivationDistance", Value = obj.MaxActivationDistance, Type = "number"},
                            {Name = "HoldDuration", Value = obj.HoldDuration, Type = "number"},
                            {Name = "Enabled", Value = obj.Enabled, Type = "boolean"}
                        }
                    })
                end
                if obj:IsA("Tool") then
                    local handle = obj:FindFirstChild("Handle")
                    table.insert(highIssues, {
                        Type = "Free Tool",
                        Object = obj,
                        Position = handle and handle.Position or Vector3.new(0,0,0),
                        Description = "Tool gratis: " .. obj.Name,
                        Effect = getEffectDescription("Free Tool", obj),
                        Path = obj:GetFullName(),
                        EditableProps = {
                            {Name = "CanBeDropped", Value = obj.CanBeDropped, Type = "boolean"},
                            {Name = "RequiresHandle", Value = obj.RequiresHandle, Type = "boolean"}
                        }
                    })
                end
                if obj:IsA("RemoteEvent") or obj:IsA("RemoteFunction") then
                    table.insert(highIssues, {
                        Type = "Remote",
                        Object = obj,
                        Position = Vector3.new(0,0,0),
                        Description = obj.ClassName .. ": " .. obj.Name,
                        Effect = getEffectDescription("Remote", obj),
                        Path = obj:GetFullName(),
                        EditableProps = {}
                    })
                end
                
                -- Check for HTTP requests in scripts
                if obj:IsA("BaseScript") or obj:IsA("ModuleScript") then
                    pcall(function()
                        local source = obj.Source
                        if source then
                            -- Look for HTTP requests
                            for url in source:gmatch("['\"](https?://[^'\"]+)['\"]") do
                                if HTTPTracker:CheckVulnerability(url) then
                                    table.insert(highIssues, {
                                        Type = "HTTP Request",
                                        Object = obj,
                                        Position = Vector3.new(0,0,0),
                                        Description = "HTTP Request: " .. url,
                                        Effect = getEffectDescription("HTTP Request", obj),
                                        Path = obj:GetFullName(),
                                        URL = url,
                                        EditableProps = {}
                                    })
                                end
                            end
                        end
                    end)
                end
            end, processed)
        end)
    end
    
    print("[SCAN] High vulnerabilities: " .. #highIssues .. " (scanned " .. count .. " objects)")
    return removeDuplicates(highIssues)
end

function MapAnalyzer:StartScan()
    print("[SCAN] Starting deep scan...")
    self.Results = {Low = {}, Medium = {}, High = {}, HTTP = {}, TotalVulnerabilities = 0}
    
    -- Scan in background to prevent lag
    spawn(function()
        self.Results.Low = self:ScanLowVulnerabilities()
        if GUI_UpdateProgress then GUI_UpdateProgress(33) end
        wait()
        
        self.Results.Medium = self:ScanMediumVulnerabilities()
        if GUI_UpdateProgress then GUI_UpdateProgress(66) end
        wait()
        
        self.Results.High = self:ScanHighVulnerabilities()
        if GUI_UpdateProgress then GUI_UpdateProgress(100) end
        
        -- Extract HTTP vulnerabilities
        for _, vuln in pairs(self.Results.High) do
            if vuln.Type == "HTTP Request" then
                table.insert(self.Results.HTTP, vuln)
            end
        end
        
        self.Results.TotalVulnerabilities = #self.Results.Low + #self.Results.Medium + #self.Results.High
        
        print("[SCAN] Complete! Total: " .. self.Results.TotalVulnerabilities)
        if GUI_UpdateResults then GUI_UpdateResults() end
    end)
    
    return self.Results
end

function MapAnalyzer:TeleportTo(vulnerability)
    local player = game.Players.LocalPlayer
    if player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        player.Character.HumanoidRootPart.CFrame = CFrame.new(vulnerability.Position + Vector3.new(0, 5, 0))
    end
end

function MapAnalyzer:HighlightObject(obj, color)
    if obj and obj:IsA("BasePart") then
        local highlight = Instance.new("SelectionBox")
        highlight.Adornee = obj
        highlight.Color3 = color
        highlight.LineThickness = 0.05
        highlight.Parent = obj
        spawn(function()
            wait(5)
            highlight:Destroy()
        end)
    end
end

-- ==================== GUI MODULE (SIMPLIFIED) ====================

if playerGui:FindFirstChild("MapAnalyzerGUI") then
    playerGui:FindFirstChild("MapAnalyzerGUI"):Destroy()
end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MapAnalyzerGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = playerGui

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 420, 0, 600)
MainFrame.Position = UDim2.new(0.5, -210, 0.5, -300)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 12)

-- Header
local Header = Instance.new("Frame")
Header.Size = UDim2.new(1, 0, 0, 45)
Header.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
Header.Parent = MainFrame
Instance.new("UICorner", Header).CornerRadius = UDim.new(0, 12)

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -140, 1, 0)
Title.Position = UDim2.new(0, 10, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "üîç MAP ANALYZER V3"
Title.TextColor3 = Color3.new(1, 1, 1)
Title.TextSize = 18
Title.Font = Enum.Font.GothamBold
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = Header

local CloseBtn = Instance.new("TextButton")
CloseBtn.Size = UDim2.new(0, 35, 0, 35)
CloseBtn.Position = UDim2.new(1, -40, 0, 5)
CloseBtn.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
CloseBtn.Text = "‚úï"
CloseBtn.TextColor3 = Color3.new(1, 1, 1)
CloseBtn.TextSize = 18
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.Parent = Header
Instance.new("UICorner", CloseBtn).CornerRadius = UDim.new(0, 8)

-- Stats Panel
local StatsPanel = Instance.new("Frame")
StatsPanel.Size = UDim2.new(1, -20, 0, 70)
StatsPanel.Position = UDim2.new(0, 10, 0, 55)
StatsPanel.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
StatsPanel.Parent = MainFrame
Instance.new("UICorner", StatsPanel).CornerRadius = UDim.new(0, 8)

local layout = Instance.new("UIListLayout")
layout.FillDirection = Enum.FillDirection.Horizontal
layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
layout.VerticalAlignment = Enum.VerticalAlignment.Center
layout.Padding = UDim.new(0, 8)
layout.Parent = StatsPanel

local function createCard(title, color)
    local card = Instance.new("Frame")
    card.Size = UDim2.new(0, 95, 0, 60)
    card.BackgroundColor3 = color
    card.Parent = StatsPanel
    Instance.new("UICorner", card).CornerRadius = UDim.new(0, 8)

    local lbl = Instance.new("TextLabel")
    lbl.Size = UDim2.new(1, 0, 0, 20)
    lbl.Position = UDim2.new(0, 0, 0, 5)
    lbl.BackgroundTransparency = 1
    lbl.Text = title
    lbl.TextColor3 = Color3.new(1, 1, 1)
    lbl.TextSize = 11
    lbl.Font = Enum.Font.Gotham
    lbl.Parent = card

    local cnt = Instance.new("TextLabel")
    cnt.Name = "Count"
    cnt.Size = UDim2.new(1, 0, 0, 30)
    cnt.Position = UDim2.new(0, 0, 0, 25)
    cnt.BackgroundTransparency = 1
    cnt.Text = "0"
    cnt.TextColor3 = Color3.new(1, 1, 1)
    cnt.TextSize = 22
    cnt.Font = Enum.Font.GothamBold
    cnt.Parent = card

    return card
end

local LowCard = createCard("LOW", Color3.fromRGB(50, 150, 50))
local MedCard = createCard("MED", Color3.fromRGB(200, 150, 50))
local HighCard = createCard("HIGH", Color3.fromRGB(200, 50, 50))
local HTTPCard = createCard("HTTP", Color3.fromRGB(255, 100, 100))

-- Scan Button
local ScanBtn = Instance.new("TextButton")
ScanBtn.Size = UDim2.new(1, -20, 0, 40)
ScanBtn.Position = UDim2.new(0, 10, 0, 135)
ScanBtn.BackgroundColor3 = Color3.fromRGB(50, 100, 200)
ScanBtn.Text = "üîé START DEEP SCAN"
ScanBtn.TextColor3 = Color3.new(1, 1, 1)
ScanBtn.TextSize = 16
ScanBtn.Font = Enum.Font.GothamBold
ScanBtn.Parent = MainFrame
Instance.new("UICorner", ScanBtn).CornerRadius = UDim.new(0, 8)

-- Progress Bar
local ProgressBar = Instance.new("Frame")
ProgressBar.Size = UDim2.new(1, -20, 0, 8)
ProgressBar.Position = UDim2.new(0, 10, 0, 185)
ProgressBar.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
ProgressBar.Parent = MainFrame
Instance.new("UICorner", ProgressBar).CornerRadius = UDim.new(0, 4)

local ProgressFill = Instance.new("Frame")
ProgressFill.Size = UDim2.new(0, 0, 1, 0)
ProgressFill.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
ProgressFill.Parent = ProgressBar
Instance.new("UICorner", ProgressFill).CornerRadius = UDim.new(0, 4)

-- FILTER TABS
local TabsFrame = Instance.new("Frame")
TabsFrame.Size = UDim2.new(1, -20, 0, 40)
TabsFrame.Position = UDim2.new(0, 10, 0, 200)
TabsFrame.BackgroundTransparency = 1
TabsFrame.Parent = MainFrame

local tabLayout = Instance.new("UIListLayout")
tabLayout.FillDirection = Enum.FillDirection.Horizontal
tabLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
tabLayout.Padding = UDim.new(0, 5)
tabLayout.Parent = TabsFrame

local activeFilter = "All"
local currentResults = nil

local function createTab(text, filter)
    local tab = Instance.new("TextButton")
    tab.Size = UDim2.new(0, 75, 0, 35)
    tab.BackgroundColor3 = Color3.fromRGB(45, 45, 60)
    tab.Text = text
    tab.TextColor3 = Color3.new(1, 1, 1)
    tab.TextSize = 12
    tab.Font = Enum.Font.GothamBold
    tab.Parent = TabsFrame
    Instance.new("UICorner", tab).CornerRadius = UDim.new(0, 8)
    tab.Name = filter
    return tab
end

local AllTab = createTab("ALL", "All")
local LowTab = createTab("LOW", "Low")
local MedTab = createTab("MED", "Medium")
local HighTab = createTab("HIGH", "High")
local HTTPTab = createTab("HTTP", "HTTP")

-- Results Scroll
local Scroll = Instance.new("ScrollingFrame")
Scroll.Size = UDim2.new(1, -20, 0, 340)
Scroll.Position = UDim2.new(0, 10, 0, 250)
Scroll.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
Scroll.ScrollBarThickness = 6
Scroll.CanvasSize = UDim2.new(0, 0, 0, 0)
Scroll.Parent = MainFrame
Instance.new("UICorner", Scroll).CornerRadius = UDim.new(0, 8)

local scrollLayout = Instance.new("UIListLayout")
scrollLayout.Padding = UDim.new(0, 5)
scrollLayout.Parent = Scroll
scrollLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    Scroll.CanvasSize = UDim2.new(0, 0, 0, scrollLayout.AbsoluteContentSize.Y + 10)
end)

-- ==================== VALUE EDITOR POPUP ====================
local EditorFrame = Instance.new("Frame")
EditorFrame.Size = UDim2.new(0, 380, 0, 450)
EditorFrame.Position = UDim2.new(0.5, -190, 0.5, -225)
EditorFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
EditorFrame.Visible = false
EditorFrame.Parent = ScreenGui
Instance.new("UICorner", EditorFrame).CornerRadius = UDim.new(0, 12)

local EditorHeader = Instance.new("Frame")
EditorHeader.Size = UDim2.new(1, 0, 0, 40)
EditorHeader.BackgroundColor3 = Color3.fromRGB(40, 40, 55)
EditorHeader.Parent = EditorFrame
Instance.new("UICorner", EditorHeader).CornerRadius = UDim.new(0, 12)

local EditorTitle = Instance.new("TextLabel")
EditorTitle.Size = UDim2.new(1, -40, 1, 0)
EditorTitle.Position = UDim2.new(0, 10, 0, 0)
EditorTitle.BackgroundTransparency = 1
EditorTitle.Text = "‚úèÔ∏è VALUE EDITOR"
EditorTitle.TextColor3 = Color3.new(1, 1, 1)
EditorTitle.TextSize = 16
EditorTitle.Font = Enum.Font.GothamBold
EditorTitle.TextXAlignment = Enum.TextXAlignment.Left
EditorTitle.Parent = EditorHeader

local EditorCloseBtn = Instance.new("TextButton")
EditorCloseBtn.Size = UDim2.new(0, 30, 0, 30)
EditorCloseBtn.Position = UDim2.new(1, -35, 0, 5)
EditorCloseBtn.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
EditorCloseBtn.Text = "‚úï"
EditorCloseBtn.TextColor3 = Color3.new(1, 1, 1)
EditorCloseBtn.TextSize = 16
EditorCloseBtn.Font = Enum.Font.GothamBold
EditorCloseBtn.Parent = EditorHeader
Instance.new("UICorner", EditorCloseBtn).CornerRadius = UDim.new(0, 6)

local EditorScroll = Instance.new("ScrollingFrame")
EditorScroll.Size = UDim2.new(1, -20, 0, 400)
EditorScroll.Position = UDim2.new(0, 10, 0, 45)
EditorScroll.BackgroundTransparency = 1
EditorScroll.ScrollBarThickness = 6
EditorScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
EditorScroll.Parent = EditorFrame

local editorLayout = Instance.new("UIListLayout")
editorLayout.Padding = UDim.new(0, 8)
editorLayout.Parent = EditorScroll
editorLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    EditorScroll.CanvasSize = UDim2.new(0, 0, 0, editorLayout.AbsoluteContentSize.Y + 10)
end)

-- ==================== FUNCTIONS ====================

local function updateTabStyles()
    for _, tab in pairs({AllTab, LowTab, MedTab, HighTab, HTTPTab}) do
        if tab.Name == activeFilter then
            tab.BackgroundColor3 = Color3.fromRGB(50, 100, 200)
        else
            tab.BackgroundColor3 = Color3.fromRGB(45, 45, 60)
        end
    end
end

local function showEditor(vulnerability)
    EditorFrame.Visible = true

    -- Clear previous content
    for _, child in pairs(EditorScroll:GetChildren()) do
        if not child:IsA("UIListLayout") then
            child:Destroy()
        end
    end

    -- Show object path
    local pathLabel = Instance.new("TextLabel")
    pathLabel.Size = UDim2.new(1, -10, 0, 60)
    pathLabel.BackgroundColor3 = Color3.fromRGB(40, 40, 55)
    pathLabel.Text = "Object Path:\n" .. vulnerability.Path
    pathLabel.TextColor3 = Color3.fromRGB(150, 150, 255)
    pathLabel.TextSize = 11
    pathLabel.Font = Enum.Font.Code
    pathLabel.TextWrapped = true
    pathLabel.TextXAlignment = Enum.TextXAlignment.Left
    pathLabel.TextYAlignment = Enum.TextYAlignment.Top
    pathLabel.Parent = EditorScroll
    Instance.new("UICorner", pathLabel).CornerRadius = UDim.new(0, 6)
    local pad = Instance.new("UIPadding", pathLabel)
    pad.PaddingLeft = UDim.new(0, 8)
    pad.PaddingTop = UDim.new(0, 8)

    -- Show effect description
    if vulnerability.Effect then
        local effectLabel = Instance.new("TextLabel")
        effectLabel.Size = UDim2.new(1, -10, 0, 50)
        effectLabel.BackgroundColor3 = Color3.fromRGB(50, 40, 30)
        effectLabel.Text = vulnerability.Effect
        effectLabel.TextColor3 = Color3.fromRGB(255, 200, 100)
        effectLabel.TextSize = 10
        effectLabel.Font = Enum.Font.Gotham
        effectLabel.TextWrapped = true
        effectLabel.TextXAlignment = Enum.TextXAlignment.Left
        effectLabel.TextYAlignment = Enum.TextYAlignment.Top
        effectLabel.Parent = EditorScroll
        Instance.new("UICorner", effectLabel).CornerRadius = UDim.new(0, 6)
        local pad2 = Instance.new("UIPadding", effectLabel)
        pad2.PaddingLeft = UDim.new(0, 8)
        pad2.PaddingTop = UDim.new(0, 8)
    end

    -- Create property editors
    for _, prop in pairs(vulnerability.EditableProps) do
        local propFrame = Instance.new("Frame")
        propFrame.Size = UDim2.new(1, -10, 0, 80)
        propFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 60)
        propFrame.Parent = EditorScroll
        Instance.new("UICorner", propFrame).CornerRadius = UDim.new(0, 6)

        local propName = Instance.new("TextLabel")
        propName.Size = UDim2.new(1, -10, 0, 20)
        propName.Position = UDim2.new(0, 5, 0, 5)
        propName.BackgroundTransparency = 1
        propName.Text = prop.Name .. " (" .. prop.Type .. ")"
        propName.TextColor3 = Color3.fromRGB(255, 255, 100)
        propName.TextSize = 12
        propName.Font = Enum.Font.GothamBold
        propName.TextXAlignment = Enum.TextXAlignment.Left
        propName.Parent = propFrame

        if prop.Type == "boolean" then
            local toggleBtn = Instance.new("TextButton")
            toggleBtn.Size = UDim2.new(1, -10, 0, 35)
            toggleBtn.Position = UDim2.new(0, 5, 0, 30)
            toggleBtn.BackgroundColor3 = prop.Value and Color3.fromRGB(50, 200, 50) or Color3.fromRGB(200, 50, 50)
            toggleBtn.Text = tostring(prop.Value)
            toggleBtn.TextColor3 = Color3.new(1, 1, 1)
            toggleBtn.TextSize = 14
            toggleBtn.Font = Enum.Font.GothamBold
            toggleBtn.Parent = propFrame
            Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(0, 6)

            toggleBtn.MouseButton1Click:Connect(function()
                if vulnerability.Object and vulnerability.Object:IsA("Instance") then
                    pcall(function()
                        vulnerability.Object[prop.Name] = not vulnerability.Object[prop.Name]
                        local newVal = vulnerability.Object[prop.Name]
                        toggleBtn.Text = tostring(newVal)
                        toggleBtn.BackgroundColor3 = newVal and Color3.fromRGB(50, 200, 50) or Color3.fromRGB(200, 50, 50)
                    end)
                end
            end)

        elseif prop.Type == "number" then
            local inputBox = Instance.new("TextBox")
            inputBox.Size = UDim2.new(0.65, -5, 0, 35)
            inputBox.Position = UDim2.new(0, 5, 0, 30)
            inputBox.BackgroundColor3 = Color3.fromRGB(55, 55, 70)
            inputBox.Text = tostring(prop.Value)
            inputBox.TextColor3 = Color3.new(1, 1, 1)
            inputBox.TextSize = 14
            inputBox.Font = Enum.Font.Code
            inputBox.PlaceholderText = "Enter number..."
            inputBox.Parent = propFrame
            Instance.new("UICorner", inputBox).CornerRadius = UDim.new(0, 6)

            -- EXECUTE BUTTON (NEW!)
            local executeBtn = Instance.new("TextButton")
            executeBtn.Size = UDim2.new(0.35, -10, 0, 35)
            executeBtn.Position = UDim2.new(0.65, 5, 0, 30)
            executeBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
            executeBtn.Text = "‚úÖ EXECUTE"
            executeBtn.TextColor3 = Color3.new(1, 1, 1)
            executeBtn.TextSize = 12
            executeBtn.Font = Enum.Font.GothamBold
            executeBtn.Parent = propFrame
            Instance.new("UICorner", executeBtn).CornerRadius = UDim.new(0, 6)

            executeBtn.MouseButton1Click:Connect(function()
                local num = tonumber(inputBox.Text)
                if num and vulnerability.Object then
                    pcall(function()
                        vulnerability.Object[prop.Name] = num
                        executeBtn.BackgroundColor3 = Color3.fromRGB(50, 255, 50)
                        executeBtn.Text = "‚úÖ DONE"
                        wait(0.5)
                        executeBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
                        executeBtn.Text = "‚úÖ EXECUTE"
                    end)
                end
            end)

        elseif prop.Type == "string" then
            local inputBox = Instance.new("TextBox")
            inputBox.Size = UDim2.new(0.65, -5, 0, 35)
            inputBox.Position = UDim2.new(0, 5, 0, 30)
            inputBox.BackgroundColor3 = Color3.fromRGB(55, 55, 70)
            inputBox.Text = tostring(prop.Value)
            inputBox.TextColor3 = Color3.new(1, 1, 1)
            inputBox.TextSize = 14
            inputBox.Font = Enum.Font.Code
            inputBox.PlaceholderText = "Enter text..."
            inputBox.Parent = propFrame
            Instance.new("UICorner", inputBox).CornerRadius = UDim.new(0, 6)

            -- EXECUTE BUTTON (NEW!)
            local executeBtn = Instance.new("TextButton")
            executeBtn.Size = UDim2.new(0.35, -10, 0, 35)
            executeBtn.Position = UDim2.new(0.65, 5, 0, 30)
            executeBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
            executeBtn.Text = "‚úÖ EXECUTE"
            executeBtn.TextColor3 = Color3.new(1, 1, 1)
            executeBtn.TextSize = 12
            executeBtn.Font = Enum.Font.GothamBold
            executeBtn.Parent = propFrame
            Instance.new("UICorner", executeBtn).CornerRadius = UDim.new(0, 6)

            executeBtn.MouseButton1Click:Connect(function()
                if vulnerability.Object and inputBox.Text ~= "" then
                    pcall(function()
                        vulnerability.Object[prop.Name] = inputBox.Text
                        executeBtn.BackgroundColor3 = Color3.fromRGB(50, 255, 50)
                        executeBtn.Text = "‚úÖ DONE"
                        wait(0.5)
                        executeBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
                        executeBtn.Text = "‚úÖ EXECUTE"
                    end)
                end
            end)

        elseif prop.Type == "vector3" then
            local vec = prop.Value
            local inputX = Instance.new("TextBox")
            inputX.Size = UDim2.new(0.22, 0, 0, 35)
            inputX.Position = UDim2.new(0, 5, 0, 30)
            inputX.BackgroundColor3 = Color3.fromRGB(55, 55, 70)
            inputX.Text = tostring(math.floor(vec.X))
            inputX.TextColor3 = Color3.new(1, 1, 1)
            inputX.TextSize = 12
            inputX.Font = Enum.Font.Code
            inputX.PlaceholderText = "X"
            inputX.Parent = propFrame
            Instance.new("UICorner", inputX).CornerRadius = UDim.new(0, 6)

            local inputY = Instance.new("TextBox")
            inputY.Size = UDim2.new(0.22, 0, 0, 35)
            inputY.Position = UDim2.new(0.24, 0, 0, 30)
            inputY.BackgroundColor3 = Color3.fromRGB(55, 55, 70)
            inputY.Text = tostring(math.floor(vec.Y))
            inputY.TextColor3 = Color3.new(1, 1, 1)
            inputY.TextSize = 12
            inputY.Font = Enum.Font.Code
            inputY.PlaceholderText = "Y"
            inputY.Parent = propFrame
            Instance.new("UICorner", inputY).CornerRadius = UDim.new(0, 6)

            local inputZ = Instance.new("TextBox")
            inputZ.Size = UDim2.new(0.22, 0, 0, 35)
            inputZ.Position = UDim2.new(0.48, 0, 0, 30)
            inputZ.BackgroundColor3 = Color3.fromRGB(55, 55, 70)
            inputZ.Text = tostring(math.floor(vec.Z))
            inputZ.TextColor3 = Color3.new(1, 1, 1)
            inputZ.TextSize = 12
            inputZ.Font = Enum.Font.Code
            inputZ.PlaceholderText = "Z"
            inputZ.Parent = propFrame
            Instance.new("UICorner", inputZ).CornerRadius = UDim.new(0, 6)

            -- EXECUTE BUTTON (NEW!)
            local executeBtn = Instance.new("TextButton")
            executeBtn.Size = UDim2.new(0.28, -10, 0, 35)
            executeBtn.Position = UDim2.new(0.72, 5, 0, 30)
            executeBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
            executeBtn.Text = "‚úÖ EXEC"
            executeBtn.TextColor3 = Color3.new(1, 1, 1)
            executeBtn.TextSize = 12
            executeBtn.Font = Enum.Font.GothamBold
            executeBtn.Parent = propFrame
            Instance.new("UICorner", executeBtn).CornerRadius = UDim.new(0, 6)

            executeBtn.MouseButton1Click:Connect(function()
                local x, y, z = tonumber(inputX.Text), tonumber(inputY.Text), tonumber(inputZ.Text)
                if x and y and z and vulnerability.Object then
                    pcall(function()
                        vulnerability.Object[prop.Name] = Vector3.new(x, y, z)
                        executeBtn.BackgroundColor3 = Color3.fromRGB(50, 255, 50)
                        executeBtn.Text = "‚úÖ"
                        wait(0.5)
                        executeBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
                        executeBtn.Text = "‚úÖ EXEC"
                    end)
                end
            end)
        end
    end
end

local function createResultCard(vuln, severity)
    local colors = {
        Low = Color3.fromRGB(50, 150, 50),
        Medium = Color3.fromRGB(200, 150, 50),
        High = Color3.fromRGB(200, 50, 50),
        HTTP = Color3.fromRGB(255, 100, 100)
    }

    local card = Instance.new("Frame")
    card.Size = UDim2.new(1, -10, 0, 110)
    card.BackgroundColor3 = Color3.fromRGB(45, 45, 60)
    card.Parent = Scroll
    Instance.new("UICorner", card).CornerRadius = UDim.new(0, 6)

    local ind = Instance.new("Frame")
    ind.Size = UDim2.new(0, 4, 1, 0)
    ind.BackgroundColor3 = colors[severity] or Color3.fromRGB(100, 100, 100)
    ind.Parent = card
    Instance.new("UICorner", ind).CornerRadius = UDim.new(0, 6)

    local type = Instance.new("TextLabel")
    type.Size = UDim2.new(1, -55, 0, 20)
    type.Position = UDim2.new(0, 8, 0, 5)
    type.BackgroundTransparency = 1
    type.Text = vuln.Type
    type.TextColor3 = Color3.new(1, 1, 1)
    type.TextSize = 13
    type.Font = Enum.Font.GothamBold
    type.TextXAlignment = Enum.TextXAlignment.Left
    type.Parent = card

    local desc = Instance.new("TextLabel")
    desc.Size = UDim2.new(1, -55, 0, 25)
    desc.Position = UDim2.new(0, 8, 0, 27)
    desc.BackgroundTransparency = 1
    desc.Text = vuln.Description
    desc.TextColor3 = Color3.fromRGB(200, 200, 200)
    desc.TextSize = 10
    desc.Font = Enum.Font.Gotham
    desc.TextXAlignment = Enum.TextXAlignment.Left
    desc.TextWrapped = true
    desc.Parent = card

    -- Effect description
    if vuln.Effect then
        local effect = Instance.new("TextLabel")
        effect.Size = UDim2.new(1, -55, 0, 30)
        effect.Position = UDim2.new(0, 8, 0, 54)
        effect.BackgroundTransparency = 1
        effect.Text = vuln.Effect
        effect.TextColor3 = Color3.fromRGB(255, 200, 100)
        effect.TextSize = 9
        effect.Font = Enum.Font.Gotham
        effect.TextXAlignment = Enum.TextXAlignment.Left
        effect.TextWrapped = true
        effect.Parent = card
    end

    local path = Instance.new("TextLabel")
    path.Size = UDim2.new(1, -55, 0, 20)
    path.Position = UDim2.new(0, 8, 0, 86)
    path.BackgroundTransparency = 1
    path.Text = "üìÅ " .. vuln.Path
    path.TextColor3 = Color3.fromRGB(150, 150, 150)
    path.TextSize = 9
    path.Font = Enum.Font.Code
    path.TextXAlignment = Enum.TextXAlignment.Left
    path.TextTruncate = Enum.TextTruncate.AtEnd
    path.Parent = card

    -- Teleport Button
    local tpBtn = Instance.new("TextButton")
    tpBtn.Size = UDim2.new(0, 40, 0, 35)
    tpBtn.Position = UDim2.new(1, -45, 0, 5)
    tpBtn.BackgroundColor3 = Color3.fromRGB(50, 100, 200)
    tpBtn.Text = "üìç"
    tpBtn.TextSize = 18
    tpBtn.Parent = card
    Instance.new("UICorner", tpBtn).CornerRadius = UDim.new(0, 6)

    tpBtn.MouseButton1Click:Connect(function()
        MapAnalyzer:TeleportTo(vuln)
        if vuln.Object then
            MapAnalyzer:HighlightObject(vuln.Object, colors[severity] or Color3.fromRGB(100, 100, 100))
        end
    end)

    -- Edit Button
    local editBtn = Instance.new("TextButton")
    editBtn.Size = UDim2.new(0, 40, 0, 35)
    editBtn.Position = UDim2.new(1, -45, 0, 45)
    editBtn.BackgroundColor3 = Color3.fromRGB(200, 150, 50)
    editBtn.Text = "‚úèÔ∏è"
    editBtn.TextSize = 16
    editBtn.Parent = card
    Instance.new("UICorner", editBtn).CornerRadius = UDim.new(0, 6)

    editBtn.MouseButton1Click:Connect(function()
        showEditor(vuln)
    end)
end

local function displayResults(results, filter)
    filter = filter or "All"

    -- Clear
    for _, child in pairs(Scroll:GetChildren()) do
        if child:IsA("Frame") then child:Destroy() end
    end

    -- Display based on filter
    if filter == "All" or filter == "Low" then
        for _, v in pairs(results.Low) do createResultCard(v, "Low") end
    end
    if filter == "All" or filter == "Medium" then
        for _, v in pairs(results.Medium) do createResultCard(v, "Medium") end
    end
    if filter == "All" or filter == "High" then
        for _, v in pairs(results.High) do createResultCard(v, "High") end
    end
    if filter == "All" or filter == "HTTP" then
        for _, v in pairs(results.HTTP) do createResultCard(v, "HTTP") end
    end

    LowCard.Count.Text = tostring(#results.Low)
    MedCard.Count.Text = tostring(#results.Medium)
    HighCard.Count.Text = tostring(#results.High)
    HTTPCard.Count.Text = tostring(#results.HTTP)
end

-- ==================== EVENT HANDLERS ====================

ScanBtn.MouseButton1Click:Connect(function()
    ScanBtn.Text = "‚è≥ SCANNING..."
    ScanBtn.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    ProgressFill.Size = UDim2.new(0, 0, 1, 0)
    wait(0.3)
    currentResults = MapAnalyzer:StartScan()
    ScanBtn.Text = "üîé START DEEP SCAN"
    ScanBtn.BackgroundColor3 = Color3.fromRGB(50, 100, 200)
end)

-- Tab Filters
for _, tab in pairs({AllTab, LowTab, MedTab, HighTab, HTTPTab}) do
    tab.MouseButton1Click:Connect(function()
        activeFilter = tab.Name
        updateTabStyles()
        if currentResults then
            displayResults(currentResults, activeFilter)
        end
    end)
end

CloseBtn.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

EditorCloseBtn.MouseButton1Click:Connect(function()
    EditorFrame.Visible = false
end)

-- Progress update function
function GUI_UpdateProgress(percent)
    ProgressFill.Size = UDim2.new(percent / 100, 0, 1, 0)
end

-- Results update function
function GUI_UpdateResults()
    if currentResults then
        displayResults(currentResults, activeFilter)
    end
end

-- Init
updateTabStyles()
print("[MAP ANALYZER V3] Loaded! Deep scan enabled.")
print("[V3] ‚úì Simplified GUI")
print("[V3] ‚úì Execute on input values")
print("[V3] ‚úì Deep scan ALL assets")
print("[V3] ‚úì Complete effect descriptions")
print("[V3] ‚úì Performance optimized")
print("[V3] ‚úì HTTP request tracking")
